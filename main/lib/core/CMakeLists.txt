# GET_FILENAME_COMPONENT(OBJNAME ${CMAKE_CURRENT_LIST_DIR} NAME)

add_definitions("-DEUDAQ_CORE_EXPORTS")

set(EUDAQ_INCLUDE_DIRS
  ${CMAKE_CURRENT_LIST_DIR}/include
  ${CMAKE_CURRENT_LIST_DIR}/include/eudaq
  CACHE INTERNAL "directory of eudaq include")

include_directories(include)
include_directories(include/eudaq)

aux_source_directory(src CORE_SRC)
add_library(${EUDAQ_CORE_LIBRARY} SHARED ${CORE_SRC})
set_target_properties(${EUDAQ_CORE_LIBRARY} PROPERTIES DEFINE_SYMBOL "core_EXPORTS" )
set_target_properties(${EUDAQ_CORE_LIBRARY} PROPERTIES VERSION ${EUDAQ_VERSION_MAJOR}.${EUDAQ_VERSION_MINOR})

if(CMAKE_COMPILER_IS_GNUCXX AND (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 5.3))
  list(APPEND ADDITIONAL_LIBRARIES stdc++fs)
endif()

LIST(APPEND ADDITIONAL_LIBRARIES ${CMAKE_DL_LIBS})
TARGET_LINK_LIBRARIES(${EUDAQ_CORE_LIBRARY} ${EUDAQ_THREADS_LIB} ${ADDITIONAL_LIBRARIES})

INSTALL(TARGETS ${EUDAQ_CORE_LIBRARY}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)

INSTALL( DIRECTORY include
  DESTINATION . 
  FILES_MATCHING PATTERN "*.hh"
  PATTERN "*~" EXCLUDE
  PATTERN "*#*" EXCLUDE
  PATTERN ".#*" EXCLUDE
  PATTERN "*CVS" EXCLUDE
  PATTERN "*.svn" EXCLUDE)
